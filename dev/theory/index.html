<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Theory · PhaseSpaceDTFE.jl</title><meta name="title" content="Theory · PhaseSpaceDTFE.jl"/><meta property="og:title" content="Theory · PhaseSpaceDTFE.jl"/><meta property="twitter:title" content="Theory · PhaseSpaceDTFE.jl"/><meta name="description" content="Documentation for PhaseSpaceDTFE.jl."/><meta property="og:description" content="Documentation for PhaseSpaceDTFE.jl."/><meta property="twitter:description" content="Documentation for PhaseSpaceDTFE.jl."/><meta property="og:url" content="https://jfeldbrugge.github.io/PhaseSpaceDTFE.jl/theory/"/><meta property="twitter:url" content="https://jfeldbrugge.github.io/PhaseSpaceDTFE.jl/theory/"/><link rel="canonical" href="https://jfeldbrugge.github.io/PhaseSpaceDTFE.jl/theory/"/><script data-outdated-warner src="../assets/warner.js"></script><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.050/juliamono.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.8/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL=".."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../assets/documenter.js"></script><script src="../search_index.js"></script><script src="../siteinfo.js"></script><script src="../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/catppuccin-mocha.css" data-theme-name="catppuccin-mocha"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/catppuccin-macchiato.css" data-theme-name="catppuccin-macchiato"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/catppuccin-frappe.css" data-theme-name="catppuccin-frappe"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/catppuccin-latte.css" data-theme-name="catppuccin-latte"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><a class="docs-logo" href="../"><img src="../assets/logo.png" alt="PhaseSpaceDTFE.jl logo"/></a><div class="docs-package-name"><span class="docs-autofit"><a href="../">PhaseSpaceDTFE.jl</a></span></div><button class="docs-search-query input is-rounded is-small is-clickable my-2 mx-auto py-1 px-2" id="documenter-search-query">Search docs (Ctrl + /)</button><ul class="docs-menu"><li><a class="tocitem" href="../">Home</a></li><li class="is-active"><a class="tocitem" href>Theory</a><ul class="internal"><li><a class="tocitem" href="#The-Delaunay-Tessellation-Field-Estimator"><span>The Delaunay Tessellation Field Estimator</span></a></li><li><a class="tocitem" href="#The-Phase-Space-Delaunay-Tessellation-Field-Estimator"><span>The Phase-Space Delaunay Tessellation Field Estimator</span></a></li></ul></li><li><a class="tocitem" href="../tutorial/">Tutorial</a></li><li><a class="tocitem" href="../citations/">Citations</a></li><li><a class="tocitem" href="../reference/">Reference</a></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><a class="docs-sidebar-button docs-navbar-link fa-solid fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a><nav class="breadcrumb"><ul class="is-hidden-mobile"><li class="is-active"><a href>Theory</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>Theory</a></li></ul></nav><div class="docs-right"><a class="docs-navbar-link" href="https://github.com/jfeldbrugge/PhaseSpaceDTFE.jl" title="View the repository on GitHub"><span class="docs-icon fa-brands"></span><span class="docs-label is-hidden-touch">GitHub</span></a><a class="docs-navbar-link" href="https://github.com/jfeldbrugge/PhaseSpaceDTFE.jl/blob/main/docs/src/theory.md" title="Edit source on GitHub"><span class="docs-icon fa-solid"></span></a><a class="docs-settings-button docs-navbar-link fa-solid fa-gear" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-article-toggle-button fa-solid fa-chevron-up" id="documenter-article-toggle-button" href="javascript:;" title="Collapse all docstrings"></a></div></header><article class="content" id="documenter-page"><h1 id="Theory"><a class="docs-heading-anchor" href="#Theory">Theory</a><a id="Theory-1"></a><a class="docs-heading-anchor-permalink" href="#Theory" title="Permalink"></a></h1><p>The <em>Delaunay Tessellation Field Estimator</em> (DTFE) and its extension to phase space (<em>PS-DTFE</em>) are mathematical tools for the reconstruction of the density and velocity field of a discrete point set. We review here the derivations underlying these reconstruction methods.</p><h2 id="The-Delaunay-Tessellation-Field-Estimator"><a class="docs-heading-anchor" href="#The-Delaunay-Tessellation-Field-Estimator">The Delaunay Tessellation Field Estimator</a><a id="The-Delaunay-Tessellation-Field-Estimator-1"></a><a class="docs-heading-anchor-permalink" href="#The-Delaunay-Tessellation-Field-Estimator" title="Permalink"></a></h2><p>Delaunay Tessellation Field Estimator (DTFE) was developed by Willem Schaap and Rien van de Weijgaert (<a href="https://www.astro.rug.nl/~weygaert/tim1publication/weyval2004.pdf">Schaap and Weijgaert 2004</a>, <a href="https://web.archive.org/web/20071210093614/http://dissertations.ub.rug.nl/faculties/science/2007/w.e.schaap/?FullItemRecord=ON">Willem Schaap 2007</a>). The DTFE method dynamically adapts to the variation of the density and geometry of the point set. The method is used in cosmological datasets (see for example <a href="https://apod.nasa.gov/apod/ap071107.html">the astronomy picture of the day, 7 November 2007</a>) as it can simultaneously capture the geometry of the voids, walls, filaments and clusters and preserve the total mass of the pointset. The total mass is not preserved in the closely related  <a href="https://en.wikipedia.org/wiki/Natural_neighbor_interpolation">natural neighbor interpolation</a> based on the Voronoi tessellation. For an efficient implementation of the DTFE method in C++ see the <a href="https://github.com/MariusCautun/DTFE">code by Marius Cautun</a>.</p><p>Consider the pointset <span>$\mathcal{P}$</span> consisting of <span>$N$</span> labelled points <span>$p_i \in \mathbb{R}^d$</span>, the velocity set <span>$\mathcal{V}$</span> consisting of the <span>$N$</span> velocities <span>$v_i \in \mathbb{R}^d$</span>, and the mass set <span>$\mathcal{M}$</span> consisting of the masses <span>$m_i \in \mathbb{R}$</span> corresponding to the points in <span>$\mathcal{P}$</span>, with <span>$i=1,\dots,N$</span>. Using the points and masses, we reconstruct the density field <span>$\rho:\mathbb{R}^d \to \mathbb{R}$</span>. Using both the points and the velocities, we construct the velocity field <span>$v:\mathbb{R}^d\to \mathbb{R}$</span>.</p><h3 id="Density-reconstruction"><a class="docs-heading-anchor" href="#Density-reconstruction">Density reconstruction</a><a id="Density-reconstruction-1"></a><a class="docs-heading-anchor-permalink" href="#Density-reconstruction" title="Permalink"></a></h3><p>Given the pointset <span>$\mathcal{P}$</span>, consider the Delaunay tesselation <span>$\mathcal{D}$</span> consisting of <span>$N_T$</span> labelled simplices <span>$D_i$</span>, with <span>$i=1,\dots, N_T$</span>. In two dimensions, a simplex is a triangle spanning three points in <span>$\mathcal{P}$</span>. In three dimensions, a simplex is a tetrahedron spanning four points in <span>$\mathcal{P}$</span>.</p><p><img src="../assets/figures/Delaunay.png" alt="A two-dimensional Delaunay tessellation with the circumscribed circles. The Delaunay tessellation has the property that no vertex is in the circumscribed circle of a triangle."/></p><p>Let&#39;s assume we can associate a (to be determined) density estimate <span>$\rho_i$</span> to each point in <span>$\mathcal{P}$</span>. Given a simplex <span>$D \in \mathcal{D}$</span> spanned by the vertices <span>$p_{l_0},\dots, p_{l_d} \in \mathcal{P}$</span>, with the corresponding densities <span>$\rho_{l_0}, \dots, \rho_{l_d}$</span>, we construct a linear interpolation of the density field in the simplex as</p><p class="math-container">\[\rho(x) = \rho_{l_0} + [\nabla \rho] (x-p_{l_0})\,,\]</p><p>with <span>$x \in D$</span> and the gradient vector <span>$\nabla \rho\in \mathbb{R}^d$</span> associated to the simplex determined by the <span>$d$</span> linear consistency relations <span>$\rho(p_{l_i}) = \rho_{l_i}$</span> for <span>$i=1,\dots,d$</span>. In matrix notation,</p><p class="math-container">\[\nabla \rho = 
\begin{pmatrix}
p_{l_1}-p_{l_0}\\
\vdots\\
p_{l_d}-p_{l_0}\\
\end{pmatrix}^{-1}
\begin{pmatrix}
\rho_1-\rho_0\\
\vdots\\
\rho_d-\rho_0\\
\end{pmatrix}\,.\]</p><p>This system of equations is solvable when none of the points <span>$p_{l_0}, \dots, p_{l_d}$</span> are collinear. The integral over the linear interpolation yields</p><p class="math-container">\[\int_D \rho(x)\mathrm{d}x = \frac{V(D)}{d+1} \sum_{i \in D} \rho_i \,,\]</p><p>with <span>$V(D)$</span> the volume of the simplex <span>$D$</span> and <span>$i$</span> the labels of the vertices of <span>$D$</span> in <span>$\mathcal{P}$</span>. Note that the volume of a simplex <span>$D$</span> spanned by <span>$p_{l_0}, \dots, p_{l_d}$</span> can be expressed as the determinant</p><p class="math-container">\[V(D) = \frac{1}{d!}
\begin{vmatrix}
p_{l_1}-p_{l_0}\\
\vdots\\
p_{l_d}-p_{l_0}\\
\end{vmatrix}\,.\]</p><p>The integral over density – assuming the density vanishes outside the convex hull of the Delaunay tesselation – takes the form</p><p class="math-container">\[\begin{align}
\int \rho(x) \mathrm{d}x 
&amp;= \sum_{i=1}^{N_T} \int_{D_i} \rho(x)\mathrm{d}x\\
&amp;= \frac{1}{d+1} \sum_{i=1}^{N_T} V(D_i) \sum_{j \in D_i} \rho_j\,,
\end{align}\]</p><p>where the first sum runs over the simplices of the tessellation and the second sum runs over the vertices of a given simplex. Note that <span>$\rho_i$</span> enters the sum for each simplex for which it is a vertex. These simplices form the star <span>$W_i$</span> of the point <span>$p_i$</span></p><p><img src="../assets/figures/Star.png" alt="The star of a vertex in a Delaunay tessellation"/></p><p>Using this observation, we reorder the double sum, by collecting the terms involving <span>$\rho_i$</span> leading to the terms <span>$\rho_i(V(D_{l_0}) + \dots + V(D_{l_n})) = \rho_i V(W_i)$</span>, with the <span>$D_{l_i}$</span>&#39;s forming the star of <span>$p_i$</span>. The integral over the density is now a single sum over the points in <span>$\mathcal{P}$</span>, <em>i.e.,</em></p><p class="math-container">\[\int \rho(x) \mathrm{d}x =\frac{1}{d+1} \sum_{i=1}^N \rho_i V(W_i)\,.\]</p><p>The key observation in DTFE is that when we chose the natural estimate of the density,</p><p class="math-container">\[\rho_i = \frac{(d+1) m_i}{V(W_i)},\]</p><p>by which the density at <span>$p_i$</span> only depends on the mass at the point and the local geometry, the integral over the density reduces to the total mass of the point set</p><p class="math-container">\[\int \rho(x)\mathrm{d}x = \sum_{i=1}^N m_i\]</p><p>as one might expect of a density reconstruction method.</p><p>Now, given a point <span>$x \in \mathbb{R}^d$</span>, we can reconstruct the density field at this point by finding the simplex in which the point lies and evaluating the linear interpolation of the density in the simplex.</p><h3 id="Velocity-reconstruction"><a class="docs-heading-anchor" href="#Velocity-reconstruction">Velocity reconstruction</a><a id="Velocity-reconstruction-1"></a><a class="docs-heading-anchor-permalink" href="#Velocity-reconstruction" title="Permalink"></a></h3><p>The velocity field of the dataset is analogously reconstructed with a linear interpolation in the Delaunay cells. Given a simplex <span>$D$</span> spanned by the vertices <span>$p_{l_0}, \dots, p_{l_d}$</span> and the associated velocities <span>$v_{l_0},\dots,v_{l_d}$</span>, we write the velocity field in the simplex <span>$D$</span> as</p><p class="math-container">\[v(x) = v_{l_0} + \nabla v (x - p_{l_0})\]</p><p>with the velocity gradient <span>$\nabla v$</span> associated to the simplex determined by the linear consistency relations <span>$v(p_{l_i}) = v_{l_i}$</span> for <span>$i=1,\dots,d$</span>. In matrix notation,</p><p class="math-container">\[\nabla v = 
\begin{pmatrix}
p_{l_1}-p_{l_0}\\
\vdots\\
p_{l_d}-p_{l_0}\\
\end{pmatrix}^{-1}
\begin{pmatrix}
v_1-v_0\\
\vdots\\
v_d-v_0\\
\end{pmatrix}\,.\]</p><p>Now, given a point <span>$x \in \mathbb{R}^d$</span>, we can reconstruct the velocity field at this point by finding the simplex in which the point lies and evaluating the corresponding linear interpolation in the simplex.</p><p>Note that the gradient <span>$\nabla v$</span> is a piecewise constant function. Given the gradient <span>$\nabla v$</span> for each simplex, it is natural to evaluate velocity deformation modes. In three dimensions, we evaluate the divergence <span>$\theta$</span>, the shear <span>$\sigma_{ij}$</span> and the vorticity <span>$\omega = \epsilon^{ijk} \omega_{ij}$</span> defined by</p><p class="math-container">\[\begin{align}
\theta &amp;= \nabla \cdot v = \frac{\partial v_x}{\partial x} + \frac{\partial v_y}{\partial y} + \frac{\partial v_z}{\partial z},\\
\sigma_{ij} &amp;= \frac{1}{2} \left[\frac{\partial v_i}{\partial x_j} + \frac{\partial v_j}{\partial x_i}\right] - \frac{1}{3} (\nabla \cdot v) \delta_{ij},\\
\omega_{ij} &amp;=\frac{1}{2} \left[\frac{\partial v_i}{\partial x_j} - \frac{\partial v_j}{\partial x_i}\right]
\end{align}\]</p><p>with the Kronecker delta <span>$\delta_{ij}$</span> and the Levi-Civita symbol <span>$\epsilon^{ijk}$</span>.</p><p>For a point <span>$x \in \mathbb{R}^d$</span>, the reconstruction amounts to looking up the corresponding simplex and velocity deformation modes.</p><h2 id="The-Phase-Space-Delaunay-Tessellation-Field-Estimator"><a class="docs-heading-anchor" href="#The-Phase-Space-Delaunay-Tessellation-Field-Estimator">The Phase-Space Delaunay Tessellation Field Estimator</a><a id="The-Phase-Space-Delaunay-Tessellation-Field-Estimator-1"></a><a class="docs-heading-anchor-permalink" href="#The-Phase-Space-Delaunay-Tessellation-Field-Estimator" title="Permalink"></a></h2><p>The Phase-Space Delaunay Tessellation Field Estimator (PS-DTFE) extends the DTFE method to phase-space, inspired by work by [...]. For more details we refer to the publication <a href="https://academic.oup.com/mnras/article/536/1/807/7915986">Phase-Space Delaunay Tesselation Field Estimator</a>. </p><p>The evolution of our universe can be described in Lagrangian fluid dynamics in terms of the Lagrangian map <span>$x_t(q) = q + s_t(q)$</span> mapping a point in the space of initial conditions (<em>Lagrangian space</em>) to a point in the current universe (<em>Eulerian space</em>). The displacement field <span>$s_t(q)$</span> captures the displacement of a particle starting at <span>$q$</span> in time <span>$t$</span>. Large-scale structure formation can be visualized with the folding of a three-dimensional dark matter sheet in six-dimensional phase-space. The projection of the dark matter sheet into Eulerian space leads to the formation of multistream regions bounded by caustics in which the density spikes.</p><p><img src="../assets/figures/Phase-Space.png" alt="Phase-Space"/></p><p>Given the Lagrangian map <span>$x_t$</span>, the density in a point <span>$x&#39;$</span> in Eulerian space is given by </p><p class="math-container">\[\rho(x&#39;) = \sum_{q \in x_t^{-1}(x&#39;)} \frac{\rho_u}{|\det( \nabla x_t(q))|} = \sum_{q \in x_t^{-1}(x&#39;)} \frac{\rho_u}{|\det( I + \nabla s_t(q))|} \,,\]</p><p>where the sum ranges over all points in Lagrangian space that stream into <span>$x&#39;$</span> at the given time <span>$t$</span>. The caustics form at the boundaries of the multistream regions where the determinant of the deformation tensor vanishes, i.e. <span>$\det(\nabla x_t)=0$</span>.</p><p>The DTFE method successfully estimates the density in the single-stream regions. However, in multistream regions, the Delaunay tessellation may identify particles as neighbours in Eulerian space that where far separated in Lagrangian space (see the central panel of the figure above). To circumvent this problem, we evaluate the Delaunay tessellation of the particle coordinates in the early (high-redshift) configuration (that is, in Lagrangian space), where the universe was still in a single-stream state. We then evolve this tessellation with the displacement field and use the evolved tessellation to estimate the density and velocity fields in Eulerian space (see the right panel of the figure above). To this end, we identify the simplices (tetrahedra in three dimensions) in which a point <span>$x&#39;$</span> resides. This is efficiently implemented using a Bounding Volume Hierarchy (BVH), a tree structure on a set of tetrahedra spanning the dark matter sheet. Having identified the incoming simplices, the reconstruction of the density and velocities is analogous to the DTFE method, with the estimates in the individual streams summed to according to the discussion above.</p></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../">« Home</a><a class="docs-footer-nextpage" href="../tutorial/">Tutorial »</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="auto">Automatic (OS)</option><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option><option value="catppuccin-latte">catppuccin-latte</option><option value="catppuccin-frappe">catppuccin-frappe</option><option value="catppuccin-macchiato">catppuccin-macchiato</option><option value="catppuccin-mocha">catppuccin-mocha</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 1.14.1 on <span class="colophon-date" title="Wednesday 30 July 2025 21:09">Wednesday 30 July 2025</span>. Using Julia version 1.11.6.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
